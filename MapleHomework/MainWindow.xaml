<ui:FluentWindow x:Class="MapleHomework.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:MapleHomework.ViewModels"
        xmlns:models="clr-namespace:MapleHomework.Models"
        xmlns:converters="clr-namespace:MapleHomework.Converters"
        xmlns:controls="clr-namespace:MapleHomework.Controls"
        mc:Ignorable="d"
        Title="Maple Scheduler"
        Icon="icon.ico"
        Height="950" Width="750"
        MaxWidth="750"
        ResizeMode="CanResizeWithGrip"
        Topmost="{Binding IsAlwaysOnTop}"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        UseLayoutRounding="True"
        Background="{DynamicResource WindowBackground}">

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:InverseBoolToVisConverter x:Key="InverseBoolToVis"/>
        <converters:DifficultyColorConverter x:Key="DifficultyColorConverter"/>
        <converters:CategoryToStringConverter x:Key="CategoryToStringConverter"/>
        <converters:CategoryToColorConverter x:Key="CategoryToColorConverter"/>
        <converters:ProgressToDashArrayConverter x:Key="ProgressToDashArrayConverter"/>


        <!-- 누락된 리소스 추가: Soft Shadow Effect -->
        <DropShadowEffect x:Key="SoftShadowEffect" BlurRadius="6" ShadowDepth="1" Opacity="0.4" Direction="270" Color="#000000"/>

        <!-- 기존 난이도 뱃지 스타일 (DifficultyColorConverter 사용) -->
        <Style x:Key="DifficultyBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="MinWidth" Value="50"/>
            <Setter Property="Background" Value="{Binding Difficulty, Converter={StaticResource DifficultyColorConverter}}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Difficulty}" Value="Chaos">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#E8DCCA"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Difficulty}" Value="Extreme">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#FF4500"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DifficultyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Difficulty}" Value="Chaos">
                    <Setter Property="Foreground">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#F5F5DC" Offset="0"/>
                                <GradientStop Color="#C4A484" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
                <DataTrigger Binding="{Binding Difficulty}" Value="Extreme">
                    <Setter Property="Foreground">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#FFA500" Offset="0"/>
                                <GradientStop Color="#FF0000" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- [공통] 태스크 아이템 템플릿 (일반 모드) -->
        <DataTemplate x:Key="TaskItemTemplate">
            <Border x:Name="TaskCard" 
                    Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                    BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                    BorderThickness="1" CornerRadius="8" Padding="12,12" Margin="0,0,8,8" Cursor="Hand"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <TranslateTransform/>
                    </TransformGroup>
                </Border.RenderTransform>
                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" 
                                  Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                  CommandParameter="{Binding}"/>
                </Border.InputBindings>
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="{Binding Category, Converter={StaticResource CategoryToColorConverter}}"/>
                                <Setter Property="BorderThickness" Value="1.5"/>
                            </Trigger>
                            <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                             From="1.0" To="0.95" Duration="0:0:0.1" AutoReverse="True"/>
                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                             From="1.0" To="0.95" Duration="0:0:0.1" AutoReverse="True"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 카테고리 뱃지 -->
                    <Grid Margin="0,0,10,0" VerticalAlignment="Center">
                        <Border CornerRadius="4" Padding="8,4" Background="{Binding Category, Converter={StaticResource CategoryToColorConverter}}" Opacity="0.2"/>
                        <TextBlock Text="{Binding Category, Converter={StaticResource CategoryToStringConverter}}" 
                                   Foreground="{Binding Category, Converter={StaticResource CategoryToColorConverter}}"
                                   FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>

                    <TextBlock Grid.Column="1" Text="{Binding Name}" 
                               Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                               FontSize="14" FontWeight="Medium" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>

                    <!-- 난이도 뱃지 (보스 전용) -->
                    <Border Grid.Column="2" Margin="5,0,0,0">
                         <Border.Style>
                             <Style TargetType="Border" BasedOn="{StaticResource DifficultyBadgeStyle}">
                                 <Setter Property="Visibility" Value="Collapsed"/>
                                 <Style.Triggers>
                                     <DataTrigger Binding="{Binding Category}" Value="Boss">
                                         <Setter Property="Visibility" Value="Visible"/>
                                     </DataTrigger>
                                 </Style.Triggers>
                             </Style>
                         </Border.Style>
                        <TextBlock Text="{Binding Difficulty}" Style="{StaticResource DifficultyTextStyle}"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- [공통] 태스크 편집 템플릿 (편집 모드) -->
        <DataTemplate x:Key="TaskEditTemplate">
            <Border Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                    BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                    BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Text="{Binding Name}" Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                               VerticalAlignment="Center" FontWeight="Medium" FontSize="15"/>

                    <!-- 보스 옵션: 파티원 수 & 난이도 -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Category}" Value="Boss">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Category}" Value="Monthly">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        
                        <!-- 파티원 수 -->
                        <ComboBox Width="90" Margin="8,0"
                                  ItemsSource="{Binding DataContext.PartySizeOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                  SelectedValue="{Binding PartySize, Mode=TwoWay}"
                                  SelectedValuePath="Count"
                                  DisplayMemberPath="Display"
                                  IsSynchronizedWithCurrentItem="False"/>
                        <!-- 난이도 -->
                        <ComboBox Width="110" Margin="0,0,8,0" 
                                  ItemsSource="{Binding AvailableDifficulties}"
                                  SelectedItem="{Binding Difficulty, Mode=TwoWay}"
                                  IsSynchronizedWithCurrentItem="False"
                                  Style="{StaticResource {x:Type ComboBox}}"/>
                    </StackPanel>

                    <ui:ToggleSwitch Grid.Column="3" IsChecked="{Binding IsActive}" VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </DataTemplate>





        <!-- [New] 프리미엄 스타 토글 스위치 스타일 -->
        <Style x:Key="StarToggleSwitchStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="54"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <!-- Track (Base) -->
                            <Border x:Name="Track" CornerRadius="14" Background="#30000000" BorderBrush="#30FFFFFF" BorderThickness="1">
                                <Border.Effect>
                                    <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.1" Direction="270"/>
                                </Border.Effect>
                            </Border>
                            
                            <!-- Track (Active Gradient) -->
                            <Border x:Name="TrackOn" CornerRadius="14" Opacity="0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0.5" EndPoint="1,0.5">
                                        <GradientStop Color="#FFD54F" Offset="0"/>
                                        <GradientStop Color="#FFB300" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect ShadowDepth="0" BlurRadius="10" Color="#FFB300" Opacity="0.5"/>
                                </Border.Effect>
                            </Border>

                            <!-- Thumb (Handle) -->
                            <Grid x:Name="Thumb" Width="22" Height="22" HorizontalAlignment="Left" Margin="3,0,0,0">
                                 <Grid.RenderTransform>
                                     <TranslateTransform X="0"/>
                                 </Grid.RenderTransform>
                                 
                                 <Ellipse Fill="White">
                                     <Ellipse.Effect>
                                         <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.3" Color="Black"/>
                                     </Ellipse.Effect>
                                 </Ellipse>
                                 
                                 <!-- Star Icon -->
                                 <ui:SymbolIcon x:Name="Icon" Symbol="Star24" FontSize="12" Foreground="#CFD8DC" 
                                                HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                                     <ui:SymbolIcon.RenderTransform>
                                         <ScaleTransform ScaleX="1" ScaleY="1"/>
                                     </ui:SymbolIcon.RenderTransform>
                                 </ui:SymbolIcon>
                            </Grid>
                        </Grid>
                        
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- Thumb Move -->
                                            <DoubleAnimation Storyboard.TargetName="Thumb" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                                                             To="26" Duration="0:0:0.4">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <!-- Track Fade In -->
                                            <DoubleAnimation Storyboard.TargetName="TrackOn" Storyboard.TargetProperty="Opacity"
                                                             To="1" Duration="0:0:0.3"/>
                                            <!-- Icon Color Change -->
                                            <ColorAnimation Storyboard.TargetName="Icon" Storyboard.TargetProperty="(TextElement.Foreground).(SolidColorBrush.Color)"
                                                            To="#FF8F00" Duration="0:0:0.2"/>
                                            <!-- Icon Pop Animation -->
                                            <DoubleAnimation Storyboard.TargetName="Icon" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                             From="0.5" To="1" Duration="0:0:0.4" BeginTime="0:0:0.1">
                                                <DoubleAnimation.EasingFunction>
                                                    <BackEase EasingMode="EaseOut" Amplitude="0.6"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                             <DoubleAnimation Storyboard.TargetName="Icon" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                             From="0.5" To="1" Duration="0:0:0.4" BeginTime="0:0:0.1">
                                                <DoubleAnimation.EasingFunction>
                                                    <BackEase EasingMode="EaseOut" Amplitude="0.6"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <!-- Icon Rotate -->

                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Thumb" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                                                             To="0" Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="TrackOn" Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.3"/>
                                            <ColorAnimation Storyboard.TargetName="Icon" Storyboard.TargetProperty="(TextElement.Foreground).(SolidColorBrush.Color)"
                                                            To="#CFD8DC" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Thumb" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="6" ShadowDepth="1" Opacity="0.4" Color="Black"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </ui:FluentWindow.Resources>

    <ui:FluentWindow.Triggers>
        <EventTrigger RoutedEvent="ui:FluentWindow.Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </ui:FluentWindow.Triggers>

    <Grid Background="{DynamicResource WindowBackground}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 메이플 스타일 타이틀바 (다크 슬레이트) -->
                <Border Grid.Row="0" Background="#3D4A5C" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown" CornerRadius="12,12,0,0">
                <Grid>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                            <!-- 사이드바 토글 버튼 -->
                            <Button Command="{Binding ToggleSidebarCommand}" Width="40" Height="32" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="전체 캐릭터 현황"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Margin="8,0,0,0">
                                <ui:SymbolIcon FontSize="18" Foreground="#5AC8FA">
                                    <ui:SymbolIcon.Style>
                                        <Style TargetType="ui:SymbolIcon">
                                            <Setter Property="Symbol" Value="ChevronLeft24"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSidebarOpen}" Value="True">
                                                    <Setter Property="Symbol" Value="ChevronRight24"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ui:SymbolIcon.Style>
                                </ui:SymbolIcon>
                            </Button>
                    <TextBlock Text="MAPLE SCHEDULER" Foreground="White" FontWeight="Bold" FontSize="13" 
                                       VerticalAlignment="Center" Margin="8,0,0,0"/>
                        </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,4,0">
                        <!-- 즐겨찾기 토글 버튼 (Premium Style) -->
                        <ToggleButton IsChecked="{Binding IsFavoriteOnlyMode}" 
                                      Style="{StaticResource StarToggleSwitchStyle}"
                                      ToolTip="즐겨찾기 항목만 보기"
                                      Margin="0,0,12,0"/>

                        <Button Click="MinimizeButton_Click" Width="46" Height="32" Padding="0"
                                Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="최소화"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                            <ui:SymbolIcon Symbol="Subtract24" FontSize="18" Foreground="#B0BEC5"/>
                        </Button>
                        <Button Click="CloseButton_Click" Width="46" Height="32" Padding="0"
                                Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="닫기"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#E81123"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <ui:SymbolIcon Symbol="Dismiss24" FontSize="18" Foreground="#B0BEC5"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 메인 컨텐츠 영역 -->
            <Border Grid.Row="1" Background="{Binding Surface}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- [New] Server Tabs & Stats -->
                        <RowDefinition Height="*"/>    <!-- Scrollable Content -->
                    </Grid.RowDefinitions>

                    <!-- [New] Server Context Area (Tabs & Dashboard) -->
                    <StackPanel Grid.Row="0" Margin="16,16,16,0">
                         <!-- Server Tabs -->
                         <ListBox ItemsSource="{Binding ServerList}" 
                                  SelectedItem="{Binding SelectedServer}"
                                  Visibility="{Binding IsServerTabVisible, Converter={StaticResource BoolToVis}}"
                                  Background="Transparent" BorderThickness="0"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  Margin="0,0,0,12">
                             <ListBox.ItemsPanel>
                                 <ItemsPanelTemplate>
                                     <StackPanel Orientation="Horizontal"/>
                                 </ItemsPanelTemplate>
                             </ListBox.ItemsPanel>
                             <ListBox.ItemContainerStyle>
                                 <Style TargetType="ListBoxItem">
                                     <Setter Property="Template">
                                         <Setter.Value>
                                             <ControlTemplate TargetType="ListBoxItem">
                                                 <Border x:Name="Bd" CornerRadius="16" Padding="16,6" Margin="0,0,8,0"
                                                         Background="#20808080" Cursor="Hand">
                                                     <TextBlock Text="{Binding}" Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Border}}" FontWeight="Bold"/>
                                                 </Border>
                                                 <ControlTemplate.Triggers>
                                                     <Trigger Property="IsSelected" Value="True">
                                                         <Setter TargetName="Bd" Property="Background" Value="{Binding DataContext.Primary, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                         <Setter Property="Foreground" Value="White"/>
                                                          <Setter TargetName="Bd" Property="Effect">
                                                             <Setter.Value>
                                                                 <DropShadowEffect ShadowDepth="0" BlurRadius="8" Color="{Binding DataContext.Primary.Color, RelativeSource={RelativeSource AncestorType=Window}}" Opacity="0.4"/>
                                                             </Setter.Value>
                                                         </Setter>
                                                     </Trigger>
                                                     <Trigger Property="IsSelected" Value="False">
                                                         <Setter Property="Foreground" Value="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                     </Trigger>
                                                 </ControlTemplate.Triggers>
                                             </ControlTemplate>
                                         </Setter.Value>
                                     </Setter>
                                 </Style>
                             </ListBox.ItemContainerStyle>
                         </ListBox>

                         <!-- Server Stats Dashboard (Glassmorphism) -->
                         <Border CornerRadius="12" Padding="16,12" Margin="0,0,0,16" Background="{Binding SurfaceContainer}"> <!-- 기본 배경 -->
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <!-- "전체" 탭일 때는 숨김 (개별 서버 볼 때만 노출) -->
                                        <DataTrigger Binding="{Binding SelectedServer}" Value="전체">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="1" BlurRadius="4" Opacity="0.1"/>
                            </Border.Effect>
                            
                             <Grid>
                                 <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                 </Grid.ColumnDefinitions>
                                 
                                 <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                      <ui:SymbolIcon Symbol="Diamond24" Filled="True" Foreground="{Binding Primary}" Margin="0,0,8,0"/>
                                      <TextBlock Text="주간 결정석 판매" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{Binding OnSurface}"/>
                                 </StackPanel>
                                 
                                 <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                     <!-- 결정석 개수 -->
                                     <TextBlock Text="{Binding CurrentServerCrystalCountText}" FontWeight="Bold" FontSize="16" Foreground="{Binding Primary}" Margin="0,0,4,0"/>
                                     <TextBlock Text="개" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Bottom" Margin="0,0,16,2" Foreground="{Binding OnSurfaceVariant}"/>
                                     
                                     <Rectangle Width="1" Height="14" Fill="{Binding Outline}" Margin="0,0,16,0" VerticalAlignment="Center"/>
                                     
                                     <!-- 메소 수익 -->
                                     <ui:SymbolIcon Symbol="Money24" FontSize="16" Foreground="#FFCC00" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                     <TextBlock Text="{Binding CurrentServerTotalMesoText}" FontWeight="Bold" FontSize="16" Foreground="{Binding OnSurface}"/>
                                      <TextBlock Text=" 메소" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Bottom" Margin="0,0,0,2" Foreground="{Binding OnSurfaceVariant}"/>
                                 </StackPanel>
                             </Grid>
                         </Border>
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0,0,4,0">
                        <StackPanel Margin="16,0,16,16"> <!-- 상단 마진 0으로 조정 (위쪽 탭 영역과 간격 고려) -->

                            <!-- 캐릭터 정보 카드 + 원형 진행률 게이지 -->
                            <!-- 전체 높이를 125로 조정, 너비는 부모 컨테이너에 맞춰 반응형으로 확장 -->
                            <Grid Height="125" Margin="0,0,0,16">
                                <!-- 1. 배경 및 카드 외형 (둥근 모서리 보장) -->
                                <Grid>
                                    <!-- 기본 배경색 -->
                                    <Border Background="{Binding SurfaceContainer}" CornerRadius="12"/>
                                    
                                    <!-- 배경 이미지 (CornerRadius 적용을 위해 ImageBrush 사용) -->
                                    <Border CornerRadius="12">
                                        <Border.Background>
                                            <ImageBrush ImageSource="{Binding CardBackgroundImage}" 
                                                        Stretch="None" AlignmentX="Left" AlignmentY="Bottom"
                                                        Opacity="1.0"/>
                                        </Border.Background>
                                    </Border>
                                    
                                    <!-- 테두리 (맨 위에 그림) -->
                                    <Border BorderBrush="{Binding Outline}" BorderThickness="1" CornerRadius="12" IsHitTestVisible="False"/>
                                </Grid>

                                <!-- 2. 콘텐츠 (클리핑 없이 위에 얹음) -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 캐릭터 이미지 (높이 100 유지 -> 카드 밖으로 돌출됨) -->
                                    <Border Width="100" Height="100" Background="Transparent" Margin="2,0,0,0"
                                            Cursor="Hand" ToolTip="캐릭터 변경" VerticalAlignment="Center">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleCharacterSelectorCommand}"/>
                                        </Border.InputBindings>
                                        <Grid>
                                            <Border>
                                                <Border.Background>
                                                    <ImageBrush Stretch="Uniform"
                                                                ImageSource="{Binding CharacterImage, TargetNullValue={x:Null}, FallbackValue={x:Null}}">
                                                        <ImageBrush.RelativeTransform>
                                                            <ScaleTransform CenterX="0.48" CenterY="0.58" ScaleX="3.0" ScaleY="3.0"/>
                                                        </ImageBrush.RelativeTransform>
                                                    </ImageBrush>
                                                </Border.Background>
                                            </Border>
                                            <!-- 캐릭터 전환 아이콘 오버레이 -->
                                            <Border Background="#80000000" CornerRadius="4" 
                                                    HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                    Padding="4" Margin="0,0,4,4">
                                                <ui:SymbolIcon Symbol="ArrowSwap20" FontSize="14" Foreground="White"/>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <!-- 캐릭터 정보 -->
                                    <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                        <!-- 이름 (흰색 + 그림자) -->
                                        <TextBlock Text="{Binding CharacterName}" Foreground="White" FontWeight="Bold" FontSize="20" Margin="0,0,0,8">
                                            <TextBlock.Effect>
                                                <DropShadowEffect ShadowDepth="1" BlurRadius="4" Opacity="0.8"/>
                                            </TextBlock.Effect>
                                        </TextBlock>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <!-- 서버 배지 (컬러 포인트 유지 - Cyan Gradient) -->
                                            <Border Background="{StaticResource MapleCyanGradient}" CornerRadius="6" Padding="8,3" Margin="0,0,6,0"
                                                    Effect="{StaticResource SoftShadowEffect}">
                                                <TextBlock Text="{Binding WorldName}" Foreground="White" FontSize="11" FontWeight="Bold">
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.5"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                            </Border>
                                        </StackPanel>
                                        
                                        <!-- 정보 (레벨/직업) - Glassy Pill (반투명 검정 배경) -->
                                        <Border Background="#4D000000" CornerRadius="8" Padding="10,4" HorizontalAlignment="Left">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="Lv." Foreground="#FFCC00" FontWeight="Bold" FontSize="12" VerticalAlignment="Bottom" Margin="0,0,2,1">
                                                     <TextBlock.Effect>
                                                        <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.8"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                                <TextBlock Text="{Binding CharacterLevel}" Foreground="White" FontWeight="Bold" FontSize="14" Margin="0,0,8,0">
                                                     <TextBlock.Effect>
                                                        <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.8"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                                <Rectangle Width="1" Height="10" Fill="#80FFFFFF" Margin="0,1,8,0"/>
                                                <TextBlock Text="{Binding CharacterClass}" Foreground="#E0E0E0" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center">
                                                     <TextBlock.Effect>
                                                        <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.8"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <!-- 원형 진행률 게이지 (회색 투명 카드 배경 추가) -->
                                    <Border Grid.Column="2" Background="#66000000" CornerRadius="12" 
                                            VerticalAlignment="Center" Margin="10,0,12,0" Padding="12,8">
                                        <StackPanel Orientation="Horizontal">
                                            <StackPanel.Resources>
                                                <!-- 기본 텍스트 스타일 (숫자용) -->
                                                <Style TargetType="TextBlock" x:Key="GaugeNumberStyle">
                                                    <Setter Property="Foreground" Value="White"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect ShadowDepth="1" BlurRadius="4" Opacity="0.8"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                                
                                                <!-- 라벨 텍스트 스타일 -->
                                                <Style TargetType="TextBlock" x:Key="GaugeLabelStyle">
                                                    <Setter Property="FontSize" Value="11"/>
                                                    <Setter Property="Foreground" Value="#E0E0E0"/>
                                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                                    <Setter Property="Margin" Value="0,4,0,0"/>
                                                </Style>
                                            </StackPanel.Resources>
                                            
                                            <!-- Daily -->
                                            <StackPanel Margin="0,0,12,0" HorizontalAlignment="Center">
                                                <Grid Width="54" Height="54">
                                                    <!-- 배경 원 제거 (카드 배경과 겹침 방지) -->
                                                    <Ellipse Fill="Transparent" Margin="4"/>
                                                    
                                                    <Ellipse Stroke="White" StrokeThickness="4" Opacity="0.3"/>
                                                    <Ellipse Stroke="{StaticResource MapleCyanGradient}" StrokeThickness="4"
                                                             StrokeDashArray="{Binding DailyProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                             StrokeDashOffset="{Binding DailyProgressOffset}"
                                                             StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                        <Ellipse.RenderTransform>
                                                            <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                        </Ellipse.RenderTransform>
                                                        <Ellipse.Effect>
                                                            <DropShadowEffect ShadowDepth="0" BlurRadius="6" Color="#00C7D8" Opacity="0.6"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>
                                                    <TextBlock Text="{Binding DailyProgress, StringFormat={}{0:0}}" FontSize="15" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                                               Style="{StaticResource GaugeNumberStyle}"/>
                                                </Grid>
                                                <TextBlock Text="일일" Style="{StaticResource GaugeLabelStyle}"/>
                                            </StackPanel>
                                            
                                            <!-- Weekly -->
                                            <StackPanel Margin="0,0,12,0" HorizontalAlignment="Center">
                                                <Grid Width="54" Height="54">
                                                    <Ellipse Fill="Transparent" Margin="4"/>
                                                    <Ellipse Stroke="White" StrokeThickness="4" Opacity="0.3"/>
                                                    <Ellipse Stroke="#FF9500" StrokeThickness="4"
                                                             StrokeDashArray="{Binding WeeklyProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                             StrokeDashOffset="{Binding WeeklyProgressOffset}"
                                                             StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                        <Ellipse.RenderTransform>
                                                            <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                        </Ellipse.RenderTransform>
                                                         <Ellipse.Effect>
                                                            <DropShadowEffect ShadowDepth="0" BlurRadius="6" Color="#FF9500" Opacity="0.6"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>
                                                    <TextBlock Text="{Binding WeeklyProgress, StringFormat={}{0:0}}" FontSize="15" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                                               Style="{StaticResource GaugeNumberStyle}"/>
                                                </Grid>
                                                <TextBlock Text="주간" Style="{StaticResource GaugeLabelStyle}"/>
                                            </StackPanel>
                                            
                                            <!-- Boss -->
                                            <StackPanel HorizontalAlignment="Center">
                                                <Grid Width="54" Height="54">
                                                    <Ellipse Fill="Transparent" Margin="4"/>
                                                    <Ellipse Stroke="White" StrokeThickness="4" Opacity="0.3"/>
                                                    <Ellipse Stroke="#FF3B30" StrokeThickness="4"
                                                             StrokeDashArray="{Binding BossProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                             StrokeDashOffset="{Binding BossProgressOffset}"
                                                             StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                        <Ellipse.RenderTransform>
                                                            <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                        </Ellipse.RenderTransform>
                                                         <Ellipse.Effect>
                                                            <DropShadowEffect ShadowDepth="0" BlurRadius="6" Color="#FF3B30" Opacity="0.6"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>
                                                    <TextBlock Text="{Binding BossProgress, StringFormat={}{0:0}}" FontSize="15" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                                               Style="{StaticResource GaugeNumberStyle}"/>
                                                </Grid>
                                                <TextBlock Text="보스" Style="{StaticResource GaugeLabelStyle}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Grid>

                            <!-- 동적 태스크 섹션 (Daily, Weekly, Boss, Monthly) -->
                            <ItemsControl ItemsSource="{Binding ActiveSectionsView}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,0,0,16">
                                            <!-- 섹션 헤더 -->
                                            <Border CornerRadius="8" Padding="12,12,16,12" Margin="0,0,0,10" Background="{Binding HeaderBackground}" Cursor="Hand">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <!-- 편집 모드가 아닐 때만 클릭 바인딩 활성화 -->
                                                            <DataTrigger Binding="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                                                                <Setter Property="Tag" Value="ClickEnabled"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Border.InputBindings>
                                                    <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleExpandCommand}"/>
                                                </Border.InputBindings>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- 접기/펼치기 아이콘 -->
                                                    <ui:SymbolIcon FontSize="16" Foreground="White" Margin="0,0,8,0" VerticalAlignment="Center">
                                                        <ui:SymbolIcon.Style>
                                                            <Style TargetType="ui:SymbolIcon">
                                                                <Setter Property="Symbol" Value="ChevronDown24"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsExpanded}" Value="False">
                                                                        <Setter Property="Symbol" Value="ChevronRight24"/>
                                                                    </DataTrigger>
                                                                    <!-- 편집 모드일 때 드래그 아이콘으로 변경 -->
                                                                    <DataTrigger Binding="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                                        <Setter Property="Symbol" Value="ReOrderDotsVertical24"/>
                                                                        <Setter Property="Cursor" Value="SizeAll"/>
                                                                        <Setter Property="ToolTip" Value="드래그하여 순서 변경"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </ui:SymbolIcon.Style>
                                                    </ui:SymbolIcon>

                                                    <Button Grid.Column="1" Command="{Binding ToggleFavoriteCommand}" Width="28" Height="28" Padding="0"
                                                            Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="즐겨찾기"
                                                            VerticalAlignment="Center" Margin="0,0,8,0">
                                                        <TextBlock FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Text" Value="☆"/>
                                                                    <Setter Property="Foreground" Value="#FFFFFF"/>
                                                                    <Setter Property="Opacity" Value="0.5"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                                            <Setter Property="Text" Value="★"/>
                                                                            <Setter Property="Foreground" Value="#FFD700"/>
                                                                            <Setter Property="Opacity" Value="1.0"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </Button>

                                                    <TextBlock Grid.Column="2" Text="{Binding Title}" Foreground="White" FontWeight="Bold" FontSize="15" VerticalAlignment="Center"/>

                                                    <!-- 보스 카운트 텍스트 (보스 섹션일 때만 보임) -->
                                                    <TextBlock Grid.Column="3" Text="{Binding SecondaryText}" 
                                                               Visibility="{Binding ShowSecondaryText, Converter={StaticResource BoolToVis}}"
                                                               Foreground="White" FontWeight="Bold" FontSize="14" 
                                                               VerticalAlignment="Center" Margin="0,0,8,0"/>

                                                    <!-- 편집 모드: 위/아래 이동 버튼 -->
                                                    <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                                                        <StackPanel.Style>
                                                            <Style TargetType="StackPanel">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </StackPanel.Style>
                                                        
                                                        <!-- 위로 이동 -->
                                                        <Button Command="{Binding DataContext.MoveSectionUpCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}"
                                                                Width="28" Height="28" Padding="0" Margin="0,0,4,0"
                                                                Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="위로 이동">
                                                            <ui:SymbolIcon Symbol="ChevronUp24" FontSize="14" Foreground="White"/>
                                                        </Button>
                                                        
                                                        <!-- 아래로 이동 -->
                                                        <Button Command="{Binding DataContext.MoveSectionDownCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}"
                                                                Width="28" Height="28" Padding="0"
                                                                Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="아래로 이동">
                                                            <ui:SymbolIcon Symbol="ChevronDown24" FontSize="14" Foreground="White"/>
                                                        </Button>
                                                    </StackPanel>


                                                </Grid>
                                            </Border>

                                            <!-- 일반 보기 (편집 모드에서 숨김) -->
                                            <ItemsControl ItemsSource="{Binding ItemsView}" ItemTemplate="{StaticResource TaskItemTemplate}">
                                                <ItemsControl.Style>
                                                    <Style TargetType="ItemsControl">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <!-- 편집 모드일 때 숨김 -->
                                                            <DataTrigger Binding="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                            <!-- 접힌 상태일 때 숨김 -->
                                                            <DataTrigger Binding="{Binding IsExpanded}" Value="False">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ItemsControl.Style>
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <UniformGrid Columns="{Binding DataContext.TaskColumnCount, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                            </ItemsControl>

                                            <!-- 편집 모드 보기 (접힌 상태면 숨김) -->
                                            <ItemsControl ItemsSource="{Binding ItemsView}" ItemTemplate="{StaticResource TaskEditTemplate}">
                                                <ItemsControl.Style>
                                                    <Style TargetType="ItemsControl">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="True"/>
                                                                    <Condition Binding="{Binding IsExpanded}" Value="True"/>
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </MultiDataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ItemsControl.Style>
                                            </ItemsControl>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>


                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 완료된 항목 섹션 (편집 모드가 아닐 때 + 완료 항목 있을 때만 표시) -->
                            <!-- ═══════════════════════════════════════════ -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsEditMode}" Value="False"/>
                                                    <Condition Binding="{Binding HasCompletedItems}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <!-- 섹션 헤더 -->
                                <Border CornerRadius="8" Padding="12,12,16,12" Margin="0,16,0,10" Background="{StaticResource MapleFinishedGradient}">
                                    <Grid MinHeight="28">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <ui:SymbolIcon Symbol="CheckmarkCircle24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                            <TextBlock Text="완료된 항목" Foreground="White" FontWeight="Bold" FontSize="15" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding CompletedList.Count, StringFormat='{}{0}개 완료'}" 
                                                   Foreground="White" FontWeight="Bold" FontSize="14" Opacity="0.9"
                                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>

                                <!-- 완료된 항목 리스트 -->
                                <ItemsControl ItemsSource="{Binding CompletedList}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border x:Name="CompletedCard"
                                                    Background="{Binding DataContext.CompletedSurface, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                    RenderTransformOrigin="0.5,0.5">
                                                <Border.RenderTransform>
                                                    <TransformGroup>
                                                        <ScaleTransform/>
                                                        <TranslateTransform/>
                                                    </TransformGroup>
                                                </Border.RenderTransform>
                                                <Border.InputBindings>
                                                    <MouseBinding MouseAction="LeftClick" 
                                                                  Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  CommandParameter="{Binding}"/>
                                                </Border.InputBindings>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="BorderBrush" Value="#4CD964"/>
                                                                <Setter Property="BorderThickness" Value="1.5"/>
                                                            </Trigger>
                                                            <!-- 복구 애니메이션 (체크 해제 시) -->
                                                            <DataTrigger Binding="{Binding IsChecked}" Value="False">
                                                                <DataTrigger.EnterActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                             From="0.95" To="1.0" Duration="0:0:0.2"/>
                                                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                             From="0.95" To="1.0" Duration="0:0:0.2"/>
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                             From="0.5" To="1.0" Duration="0:0:0.2"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </DataTrigger.EnterActions>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- 완료 체크 아이콘 -->
                                                    <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                            Background="#4CD964" VerticalAlignment="Center">
                                                        <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="White"
                                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>

                                                    <!-- 완료된 항목 이름 (취소선) -->
                                                    <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                               Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                               FontSize="15" FontWeight="Medium" VerticalAlignment="Center"
                                                               TextDecorations="Strikethrough" Opacity="0.7"/>

                                                    <!-- 카테고리 뱃지 -->
                                                    <Border Grid.Column="2" CornerRadius="4" Padding="10,5" Margin="10,0,0,0"
                                                            Background="{Binding Category, Converter={StaticResource CategoryToColorConverter}}"
                                                            Opacity="0.8" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Category, Converter={StaticResource CategoryToStringConverter}}" 
                                                                   Foreground="White" FontSize="11" FontWeight="Bold"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>

                                                    <!-- 되돌리기 힌트 아이콘 -->
                                                    <ui:SymbolIcon Grid.Column="3" Symbol="ArrowUndo16" 
                                                                   FontSize="16" Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                   Margin="12,0,0,0" Opacity="0.5" ToolTip="클릭하여 복구"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- 기존 하단바 삭제됨 - 새 하단바는 Grid.Row="2"에 있음 -->
                </Grid>
            </Border>

            <!-- 캐릭터 선택 팝업 오버레이 -->
            <Border Grid.RowSpan="2" Background="#80000000" 
                    Visibility="{Binding IsCharacterSelectorOpen, Converter={StaticResource BoolToVis}}">
                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleCharacterSelectorCommand}"/>
                </Border.InputBindings>
                
                <Border Background="{Binding SurfaceContainer}" CornerRadius="16" 
                        HorizontalAlignment="Center" VerticalAlignment="Center"
                        MaxWidth="500" MinWidth="350" MaxHeight="650"
                        Margin="20" Padding="24">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" ShadowDepth="8" Opacity="0.5"/>
                    </Border.Effect>
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick" Command="{x:Null}"/>
                    </Border.InputBindings>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 헤더 -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,20">
                            <TextBlock Text="캐릭터 선택" Foreground="{Binding OnSurface}" 
                                       FontSize="24" FontWeight="Bold"/>
                            <TextBlock Text="{Binding Characters.Count, StringFormat='{}{0}/10 캐릭터'}" 
                                       Foreground="{Binding OnSurfaceVariant}" FontSize="14" Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- 캐릭터 리스트 -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="450">
                            <controls:DragDropListBox x:Name="CharacterDragDropList"
                                                       ItemsSource="{Binding CharactersView}"
                                                       SelectedItem="{Binding SelectedCharacter, Mode=TwoWay}"
                                                       ItemsReordered="CharacterDragDropList_ItemsReordered"
                                                       Background="Transparent"
                                                       BorderThickness="0"
                                                       ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <controls:DragDropListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0,0,0,8"/>
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="Bd" 
                                                            Background="{Binding DataContext.Surface, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CornerRadius="8" Padding="10" Cursor="Hand"
                                                            BorderThickness="2" BorderBrush="Transparent">
                                                        <ContentPresenter/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Bd" Property="BorderBrush" Value="#5AC8FA"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="{DynamicResource SurfaceVariant}"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </controls:DragDropListBox.ItemContainerStyle>
                                <controls:DragDropListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="85"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- 캐릭터 이미지 (70x70) -->
                                            <Border x:Name="CharacterAvatar" Width="70" Height="70" CornerRadius="35" Background="Transparent" ClipToBounds="True">
                                                <Border>
                                                    <Border.Background>
                                                        <ImageBrush Stretch="UniformToFill"
                                                                    ImageSource="{Binding DataContext.ImageUrl, ElementName=CharacterAvatar, TargetNullValue={x:Null}, FallbackValue={x:Null}}">
                                                            <ImageBrush.RelativeTransform>
                                                                <ScaleTransform CenterX="0.5" CenterY="0.55" ScaleX="3.6" ScaleY="3.6"/>
                                                            </ImageBrush.RelativeTransform>
                                                        </ImageBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Border>

                                            <!-- 캐릭터 정보 -->
                                            <StackPanel Grid.Column="1" Margin="14,0,0,0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Nickname}" 
                                                           Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           FontSize="16" FontWeight="Bold"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                                    <TextBlock Text="Lv." Foreground="#5AC8FA" FontSize="12" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Level}" 
                                                               Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                               FontSize="14" FontWeight="Bold" Margin="2,0,8,0"/>
                                                    <TextBlock Text="{Binding CharacterClass}" 
                                                               Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                               FontSize="12"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- 삭제 버튼 -->
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Button Command="{Binding DataContext.RemoveCharacterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Width="32" Height="32" Padding="0"
                                                        Background="Transparent" BorderThickness="0" Cursor="Hand"
                                                        ToolTip="캐릭터 삭제" Opacity="0.6">
                                                    <ui:SymbolIcon Symbol="Delete24" FontSize="18" Foreground="#FF6B6B"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </controls:DragDropListBox.ItemTemplate>
                            </controls:DragDropListBox>
                        </ScrollViewer>

                        <!-- 추가 버튼 영역 -->
                        <Grid Grid.Row="2" Margin="0,20,0,0">
                            <!-- 일반 모드: 추가 버튼 -->
                            <Button Command="{Binding StartAddCharacterCommand}" 
                                    HorizontalAlignment="Stretch" Height="40"
                                    Background="#5AC8FA" Foreground="White" 
                                    Padding="12,0" Cursor="Hand"
                                    IsEnabled="{Binding CanAddCharacter}"
                                    Visibility="{Binding IsAddingCharacter, Converter={StaticResource InverseBoolToVis}}">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            CornerRadius="10" Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Opacity" Value="0.5"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="Add24" FontSize="20" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock Text="새 캐릭터 추가" FontSize="16" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Button>

                            <!-- 입력 모드: 이름 입력 + 확인/취소 -->
                            <Border Background="{Binding Surface}" CornerRadius="10" Padding="4" BorderBrush="#5AC8FA" BorderThickness="2"
                                    Visibility="{Binding IsAddingCharacter, Converter={StaticResource BoolToVis}}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding NewCharacterName, UpdateSourceTrigger=PropertyChanged}" 
                                             Background="Transparent" BorderThickness="0" Height="36"
                                             Foreground="{Binding OnSurface}" FontSize="16" 
                                             Padding="12,5" VerticalContentAlignment="Center"
                                             ToolTip="캐릭터 닉네임 입력">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding ConfirmAddCharacterCommand}"/>
                                            <KeyBinding Key="Esc" Command="{Binding CancelAddCharacterCommand}"/>
                                        </TextBox.InputBindings>
                                    </TextBox>
                                    
                                    <ui:Button Grid.Column="1" Command="{Binding ConfirmAddCharacterCommand}"
                                            Width="36" Height="36" Margin="4,0" Padding="0"
                                            Background="#5AC8FA" BorderThickness="0" Cursor="Hand" CornerRadius="8"
                                            ToolTip="확인">
                                        <ui:SymbolIcon Symbol="Checkmark24" FontSize="20" Foreground="White"/>
                                    </ui:Button>
                                    <ui:Button Grid.Column="2" Command="{Binding CancelAddCharacterCommand}"
                                            Width="36" Height="36" Margin="0,0,4,0" Padding="0"
                                            Background="#FF6B6B" BorderThickness="0" Cursor="Hand" CornerRadius="8"
                                            ToolTip="취소">
                                        <ui:SymbolIcon Symbol="Dismiss24" FontSize="20" Foreground="White"/>
                                    </ui:Button>
                                </Grid>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Border>

            <!-- 하단바 -->
            <Border Grid.Row="2" Background="#2D3748" CornerRadius="0,0,12,12" Padding="12,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 왼쪽: 버전 정보 -->
                    <!-- 왼쪽: 버전 정보 (일반 모드) / 저장 취소 (편집 모드) -->
                    <Grid Grid.Column="0" VerticalAlignment="Center" Margin="4,0,0,0">
                        <TextBlock Text="v1.0.0" Foreground="#64748B" FontSize="11" 
                                   Visibility="{Binding IsEditMode, Converter={StaticResource InverseBoolToVis}}"/>
                        
                        <StackPanel Orientation="Horizontal" Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                            <!-- 저장 버튼 -->
                            <Button Command="{Binding SaveEditCommand}" Content="저장" 
                                    Background="#5AC8FA" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Width="60" Height="28" Padding="0" Margin="0,0,8,0">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="6"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                            <!-- 취소 버튼 -->
                            <Button Command="{Binding CancelEditCommand}" Content="취소" 
                                    Background="#FF6B6B" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Width="60" Height="28" Padding="0">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="6"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </StackPanel>
                    </Grid>
                    
                    <!-- 다크/라이트 모드 토글 -->
                    <Button Grid.Column="2" Command="{Binding ToggleThemeCommand}" 
                            Width="36" Height="36" Padding="0" Margin="0,0,8,0"
                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                            ToolTip="다크/라이트 모드 전환">
                        <ui:SymbolIcon Symbol="{Binding ThemeIcon}" FontSize="18" Foreground="#94A3B8"/>
                    </Button>
                    
                    <!-- 오른쪽: 편집 모드 토글 (아이콘+텍스트) -->
                    <Button Grid.Column="3" Command="{Binding ToggleEditModeCommand}" 
                            Height="36" Padding="12,0" Margin="0,0,8,0"
                            Cursor="Hand" ToolTip="편집 모드 전환">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Bd" CornerRadius="8" Padding="{TemplateBinding Padding}"
                                                    Background="#3D4A5C" BorderThickness="1" BorderBrush="#4A5568">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="#4A5568"/>
                                                </Trigger>
                                                <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                                    <Setter TargetName="Bd" Property="Background">
                                                        <Setter.Value>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                <GradientStop Color="#FF9500" Offset="0"/>
                                                                <GradientStop Color="#FF6B6B" Offset="1"/>
                                                            </LinearGradientBrush>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Setter TargetName="Bd" Property="BorderBrush" Value="Transparent"/>
                                                </DataTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon FontSize="14" Foreground="White" Margin="0,0,6,0">
                                <ui:SymbolIcon.Style>
                                    <Style TargetType="ui:SymbolIcon">
                                        <Setter Property="Symbol" Value="Edit24"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                                <Setter Property="Symbol" Value="Dismiss24"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ui:SymbolIcon.Style>
                            </ui:SymbolIcon>
                            <TextBlock Foreground="White" FontSize="12" FontWeight="SemiBold" FontFamily="Pretendard" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="편집"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                                <Setter Property="Text" Value="편집 중"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Button>
                    
                    <!-- 메뉴 버튼 -->
                    <Button x:Name="BottomMenuButton" Grid.Column="4" Click="BottomMenuButton_Click" 
                            Cursor="Hand" Padding="14,8">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Bd" CornerRadius="10" Padding="{TemplateBinding Padding}">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#5AC8FA" Offset="0"/>
                                                        <GradientStop Color="#4ECDC4" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Opacity" Value="0.9"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Navigation24" FontSize="16" Foreground="White" Margin="0,0,8,0"/>
                            <TextBlock Text="메뉴" Foreground="White" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <ui:SymbolIcon Symbol="ChevronUp24" FontSize="14" Foreground="White" Margin="8,0,0,0"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    
    <!-- [New] 전체 캐릭터 현황 사이드바 오버레이 (Z-Index 최상위) -->
    <Grid x:Name="SidebarOverlay" Visibility="{Binding IsSidebarOpen, Converter={StaticResource BoolToVis}}" Panel.ZIndex="100">
        <!-- 배경 클릭 시 닫기 (반투명 배경) -->
        <Border Background="#40000000" MouseLeftButtonDown="SidebarOverlay_MouseLeftButtonDown">
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <!-- 사이드바 열릴 때 페이드 인 -->
                        <DataTrigger Binding="{Binding IsSidebarOpen}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
        </Border>

        <!-- 사이드바 패널 (왼쪽에서 슬라이드) -->
        <Border HorizontalAlignment="Left" VerticalAlignment="Stretch" Width="380"
                Background="#2D3748" BorderBrush="#374151" BorderThickness="0,0,1,0">
            <Border.RenderTransform>
                <TranslateTransform X="-380"/> <!-- 초기 위치: 화면 밖 -->
            </Border.RenderTransform>
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSidebarOpen}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                                                         To="0" Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                                                         To="-380" Duration="0:0:0.2"> <!-- 닫힐 때 다시 숨김 -->
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseIn"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.4" Direction="0"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Header -->
                    <RowDefinition Height="*"/>    <!-- Content -->
                </Grid.RowDefinitions>

                <!-- 사이드바 헤더 -->
                <Border Grid.Row="0" Padding="20,18">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#0EA5E9" Offset="0"/>
                            <GradientStop Color="#6366F1" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <ui:SymbolIcon Symbol="People24" FontSize="20" Foreground="White" Margin="0,0,12,0"/>
                            <TextBlock Text="전체 캐릭터 현황" Foreground="White" FontSize="18" FontWeight="Bold"/>
                            <TextBlock Text="{Binding Characters.Count, StringFormat='{}{0}명'}" 
                                       Foreground="#E0E7FF" FontSize="14" FontWeight="SemiBold" 
                                       VerticalAlignment="Bottom" Margin="8,0,0,2" Opacity="0.8"/>
                        </StackPanel>
                        
                        <Button Command="{Binding ToggleSidebarCommand}" 
                                HorizontalAlignment="Right" VerticalAlignment="Center"
                                Width="32" Height="32" Padding="0"
                                Background="#20FFFFFF" BorderThickness="0" Cursor="Hand"
                                ToolTip="닫기">
                            <ui:SymbolIcon Symbol="Dismiss24" FontSize="16" Foreground="White"/>
                        </Button>
                    </Grid>
                </Border>

                <!-- 캐릭터 리스트 -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16,20">
                    <controls:DragDropListBox x:Name="SidebarCharacterDragDropList"
                                               ItemsSource="{Binding CharactersView}"
                                               SelectedItem="{Binding SelectedCharacter, Mode=TwoWay}"
                                               ItemsReordered="CharacterDragDropList_ItemsReordered"
                                               Background="Transparent"
                                               BorderThickness="0"
                                               ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <controls:DragDropListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,0,0,16"/>
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border x:Name="Bd" 
                                                    Background="#1F2937"
                                                    CornerRadius="12" Padding="16" Cursor="Hand"
                                                    BorderThickness="1" BorderBrush="#374151">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Bd" Property="BorderBrush" Value="#5AC8FA"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                                    <Setter TargetName="Bd" Property="BorderBrush" Value="#5AC8FA"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </controls:DragDropListBox.ItemContainerStyle>
                        <controls:DragDropListBox.ItemTemplate>
                            <DataTemplate>
                                <!-- 캐릭터 카드 콘텐츠 -->
                                <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/> <!-- Avatar -->
                                            <ColumnDefinition Width="*"/>    <!-- Info -->
                                        </Grid.ColumnDefinitions>

                                        <!-- Avatar -->
                                        <Border Width="64" Height="64" CornerRadius="32" ClipToBounds="True" Background="#111827">
                                            <Border>
                                                <Border.Background>
                                                    <ImageBrush Stretch="UniformToFill"
                                                                ImageSource="{Binding ImageUrl, TargetNullValue={x:Null}, FallbackValue={x:Null}}">
                                                        <ImageBrush.RelativeTransform>
                                                            <ScaleTransform CenterX="0.5" CenterY="0.55" ScaleX="3.5" ScaleY="3.5"/>
                                                        </ImageBrush.RelativeTransform>
                                                    </ImageBrush>
                                                </Border.Background>
                                            </Border>
                                        </Border>

                                        <!-- Info & Progress -->
                                        <StackPanel Grid.Column="1" Margin="16,0,0,0">
                                            <!-- Top Line: Name & Level -->
                                            <Grid Margin="0,0,0,12">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Nickname}" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                                    <!-- Server Badge -->
                                                    <Border Background="#374151" CornerRadius="4" Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding WorldName}" Foreground="#9CA3AF" FontSize="10" FontWeight="SemiBold"/>
                                                    </Border>
                                                </StackPanel>
                                                
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                                    <TextBlock Text="Lv." Foreground="#5AC8FA" FontSize="11" FontWeight="Bold" Margin="0,2,2,0"/>
                                                    <TextBlock Text="{Binding Level}" Foreground="White" FontSize="14" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Progress Bars -->
                                            <!-- 1. Daily -->
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="36"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="일일" Foreground="#5AC8FA" FontSize="11" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                
                                                <Grid Grid.Column="1" Height="8">
                                                    <Border Background="#111827" CornerRadius="4"/>
                                                    <!-- Width 바인딩: 전체 너비 대비 비율 계산 필요하지만 Grid Star로 처리 어려움 
                                                         대신 Grid.Column 내부에서 비율로 채우기 위해 Grid 사용 -->

                                                    <!-- 심플하게 ProgressBar 사용 -->
                                                    <ProgressBar Value="{Binding DailyProgress, Mode=OneWay}" Maximum="100" Height="8" 
                                                                 Foreground="#5AC8FA" Background="#111827" BorderThickness="0">
                                                         <ProgressBar.Template>
                                                            <ControlTemplate TargetType="ProgressBar">
                                                                <Grid>
                                                                    <Border Name="PART_Track" CornerRadius="4" Background="{TemplateBinding Background}"/>
                                                                    <Border Name="PART_Indicator" CornerRadius="4" Background="{TemplateBinding Foreground}" HorizontalAlignment="Left"/>
                                                                </Grid>
                                                            </ControlTemplate>
                                                        </ProgressBar.Template>
                                                    </ProgressBar>
                                                </Grid>
                                                
                                                <TextBlock Grid.Column="2" Text="{Binding DailyProgress, StringFormat='{}{0:0}%'}" 
                                                           Foreground="#5AC8FA" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                            </Grid>

                                            <!-- 2. Weekly -->
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="36"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="주간" Foreground="#FBBF24" FontSize="11" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                 <ProgressBar Grid.Column="1" Value="{Binding WeeklyProgress, Mode=OneWay}" Maximum="100" Height="8" 
                                                                 Foreground="#FBBF24" Background="#111827" BorderThickness="0">
                                                         <ProgressBar.Template>
                                                            <ControlTemplate TargetType="ProgressBar">
                                                                <Grid>
                                                                    <Border Name="PART_Track" CornerRadius="4" Background="{TemplateBinding Background}"/>
                                                                    <Border Name="PART_Indicator" CornerRadius="4" Background="{TemplateBinding Foreground}" HorizontalAlignment="Left"/>
                                                                </Grid>
                                                            </ControlTemplate>
                                                        </ProgressBar.Template>
                                                    </ProgressBar>
                                                <TextBlock Grid.Column="2" Text="{Binding WeeklyProgress, StringFormat='{}{0:0}%'}" 
                                                           Foreground="#FBBF24" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                            </Grid>

                                            <!-- 3. Boss -->
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="40"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="36"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="보스" Foreground="#F87171" FontSize="11" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                 <ProgressBar Grid.Column="1" Value="{Binding BossProgress, Mode=OneWay}" Maximum="100" Height="8" 
                                                                 Foreground="#F87171" Background="#111827" BorderThickness="0">
                                                         <ProgressBar.Template>
                                                            <ControlTemplate TargetType="ProgressBar">
                                                                <Grid>
                                                                    <Border Name="PART_Track" CornerRadius="4" Background="{TemplateBinding Background}"/>
                                                                    <Border Name="PART_Indicator" CornerRadius="4" Background="{TemplateBinding Foreground}" HorizontalAlignment="Left"/>
                                                                </Grid>
                                                            </ControlTemplate>
                                                        </ProgressBar.Template>
                                                    </ProgressBar>
                                                <TextBlock Grid.Column="2" Text="{Binding BossProgress, StringFormat='{}{0:0}%'}" 
                                                           Foreground="#F87171" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                            </Grid>

                                        </StackPanel>
                                    </Grid>
                            </DataTemplate>
                        </controls:DragDropListBox.ItemTemplate>
                    </controls:DragDropListBox>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>

    <!-- 메뉴 오버레이 (Popup 대체) -->
    <Grid x:Name="MenuOverlay" Visibility="Collapsed">
        <!-- 배경 클릭 시 닫기 -->
        <Button Background="#01000000" BorderThickness="0" 
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                Click="CloseMenuPopup">
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Button.Style>
        </Button>

        <Border HorizontalAlignment="Right" VerticalAlignment="Bottom"
                Margin="0,0,16,60" CornerRadius="16" Padding="8"
                BorderBrush="#3D4A5C" BorderThickness="1"
                Width="260">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#2D3748" Offset="0"/>
                    <GradientStop Color="#1A202C" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect BlurRadius="24" ShadowDepth="4" Opacity="0.4" Color="Black"/>
            </Border.Effect>
            <StackPanel Width="260">
                <!-- 통계 리포트 -->
                <Button Click="OpenStatisticsReport_Click" Cursor="Hand" Margin="0,0,0,4">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="Bd" CornerRadius="12" Padding="12,10" Background="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#7C3AED" Offset="0"/>
                                    <GradientStop Color="#A855F7" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ui:SymbolIcon Symbol="DataHistogram24" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="통계 리포트" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                            <TextBlock Text="성장 기록 및 장비 변경 내역" Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <!-- 전체 캐릭터 현황 (DashboardWindow) -->
                <Button Click="OpenDashboard_Click" Cursor="Hand" Margin="0,0,0,4">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="Bd" CornerRadius="12" Padding="12,10" Background="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#5AC8FA" Offset="0"/>
                                    <GradientStop Color="#818CF8" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ui:SymbolIcon Symbol="DataBarVertical24" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="전체 캐릭터 현황" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                            <TextBlock Text="모든 캐릭터 숙제 진행도" Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <!-- 보스 수익 계산기 -->
                <Button Click="OpenBossCalculator_Click" Cursor="Hand" Margin="0,0,0,4">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="Bd" CornerRadius="12" Padding="12,10" Background="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#F59E0B" Offset="0"/>
                                    <GradientStop Color="#FBBF24" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ui:SymbolIcon Symbol="Calculator24" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="보스 수익 계산기" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                            <TextBlock Text="주간 보스 결정석 수익 계산" Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <!-- 캐릭터 검색 -->
                <Button Click="OpenCharacterSearch_Click" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="Bd" CornerRadius="12" Padding="12,10" Background="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#0EA5E9" Offset="0"/>
                                    <GradientStop Color="#6366F1" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ui:SymbolIcon Symbol="PersonSearch24" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="캐릭터 검색" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                            <TextBlock Text="다른 캐릭터 장비/코어 조회" Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <!-- 구분선 -->
                <Border Height="1" Background="#374151" Margin="12,8"/>
                
                <!-- 설정 -->
                <Button Click="OpenSettings_Click" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="Bd" CornerRadius="12" Padding="12,10" Background="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="Background" Value="#374151"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Width="40" Height="40" CornerRadius="10" Margin="0,0,12,0" Background="#475569">
                            <ui:SymbolIcon Symbol="Settings24" FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="설정" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                            <TextBlock Text="API 키 및 앱 설정" Foreground="#94A3B8" FontSize="10" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Grid>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
    </Grid>
</ui:FluentWindow>
