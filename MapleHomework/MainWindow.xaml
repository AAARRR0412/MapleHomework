<Window x:Class="MapleHomework.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:MapleHomework.ViewModels"
        xmlns:models="clr-namespace:MapleHomework.Models"
        xmlns:converters="clr-namespace:MapleHomework.Converters"
        mc:Ignorable="d"
        Title="Maple Scheduler"
        Height="950" Width="560"
        WindowStyle="None"
        AllowsTransparency="True" 
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        Topmost="True">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:InverseBoolToVisConverter x:Key="InverseBoolToVis"/>
        <converters:DifficultyColorConverter x:Key="DifficultyColorConverter"/>
        <converters:CategoryToStringConverter x:Key="CategoryToStringConverter"/>
        <converters:CategoryToColorConverter x:Key="CategoryToColorConverter"/>
        <converters:ProgressToDashArrayConverter x:Key="ProgressToDashArrayConverter"/>

        <!-- 메이플 시안 그라데이션 브러시 -->
        <LinearGradientBrush x:Key="MapleCyanGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#5AC8FA" Offset="0"/>
            <GradientStop Color="#4ECDC4" Offset="1"/>
        </LinearGradientBrush>

        <!-- 기존 난이도 뱃지 스타일 (DifficultyColorConverter 사용) -->
        <Style x:Key="DifficultyBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="MinWidth" Value="50"/>
            <Setter Property="Background" Value="{Binding Difficulty, Converter={StaticResource DifficultyColorConverter}}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Difficulty}" Value="Chaos">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#E8DCCA"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Difficulty}" Value="Extreme">
                    <Setter Property="Background" Value="#2A2A2A"/>
                    <Setter Property="BorderBrush" Value="#FF4500"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DifficultyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Difficulty}" Value="Chaos">
                    <Setter Property="Foreground">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#F5F5DC" Offset="0"/>
                                <GradientStop Color="#C4A484" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
                <DataTrigger Binding="{Binding Difficulty}" Value="Extreme">
                    <Setter Property="Foreground">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <GradientStop Color="#FFA500" Offset="0"/>
                                <GradientStop Color="#FF0000" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Window.Triggers>

    <Border CornerRadius="12" ClipToBounds="True" Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.3" Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 메이플 스타일 타이틀바 (다크 슬레이트) -->
            <Border Grid.Row="0" Background="#3D4A5C" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <TextBlock Text="MAPLE SCHEDULER" Foreground="White" FontWeight="Bold" FontSize="13" 
                               VerticalAlignment="Center" HorizontalAlignment="Left" Margin="20,0,0,0"/>
                </Grid>
            </Border>

            <!-- 메인 컨텐츠 영역 -->
            <Border Grid.Row="1" Background="{Binding Surface}">
                <Grid>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,4,0" Margin="0,0,0,44">
                        <StackPanel Margin="16,12,16,16">

                            <!-- 캐릭터 정보 카드 + 원형 진행률 게이지 -->
                            <Border Background="{Binding SurfaceContainer}" CornerRadius="12" Padding="6,12,12,12" Margin="0,0,0,16" 
                                    BorderBrush="{Binding Outline}" BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 캐릭터 이미지 (클릭하면 캐릭터 선택) -->
                                    <Border Width="100" Height="100" ClipToBounds="True" Background="Transparent" Margin="-4,0,0,0"
                                            Cursor="Hand" ToolTip="캐릭터 변경">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleCharacterSelectorCommand}"/>
                                        </Border.InputBindings>
                                        <Grid>
                                            <Border>
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{Binding CharacterImage}" Stretch="Uniform">
                                                        <ImageBrush.RelativeTransform>
                                                            <ScaleTransform CenterX="0.48" CenterY="0.58" ScaleX="3.0" ScaleY="3.0"/>
                                                        </ImageBrush.RelativeTransform>
                                                    </ImageBrush>
                                                </Border.Background>
                                            </Border>
                                            <!-- 캐릭터 전환 아이콘 오버레이 -->
                                            <Border Background="#80000000" CornerRadius="4" 
                                                    HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                    Padding="4" Margin="0,0,4,4">
                                                <ui:SymbolIcon Symbol="ArrowSwap20" FontSize="14" Foreground="White"/>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <!-- 캐릭터 정보 -->
                                    <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding CharacterName}" Foreground="{Binding OnSurface}" FontWeight="Bold" FontSize="19" Margin="0,0,0,6"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                            <Border Background="{StaticResource MapleCyanGradient}" CornerRadius="4" Padding="10,4">
                                                <TextBlock Text="{Binding WorldName}" Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                                            </Border>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Lv." Foreground="{Binding Primary}" FontWeight="Bold" FontSize="12"/>
                                            <TextBlock Text="{Binding CharacterLevel}" Foreground="{Binding OnSurface}" FontWeight="Bold" FontSize="15" Margin="2,0,10,0"/>
                                            <TextBlock Text="{Binding CharacterClass}" Foreground="{Binding OnSurfaceVariant}" FontSize="12"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- 원형 진행률 게이지 -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                                        <!-- Daily (둘레 = π × (54-6) ≈ 150.8) -->
                                        <StackPanel Margin="0,0,10,0" HorizontalAlignment="Center">
                                            <Grid Width="54" Height="54">
                                                <Ellipse Stroke="{Binding Outline}" StrokeThickness="6" Fill="Transparent"/>
                                                <Ellipse Stroke="{StaticResource MapleCyanGradient}" StrokeThickness="6" Fill="Transparent"
                                                         StrokeDashArray="{Binding DailyProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                         StrokeDashOffset="{Binding DailyProgressOffset}"
                                                         StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                    <Ellipse.RenderTransform>
                                                        <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                    </Ellipse.RenderTransform>
                                                </Ellipse>
                                                <TextBlock Text="{Binding DailyProgress, StringFormat={}{0:0}}" FontSize="16" FontWeight="Bold" 
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{Binding OnSurface}"/>
                                            </Grid>
                                            <TextBlock Text="일일" FontSize="11" Foreground="{Binding OnSurfaceVariant}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                        <!-- Weekly -->
                                        <StackPanel Margin="0,0,10,0" HorizontalAlignment="Center">
                                            <Grid Width="54" Height="54">
                                                <Ellipse Stroke="{Binding Outline}" StrokeThickness="6" Fill="Transparent"/>
                                                <Ellipse Stroke="#FF9500" StrokeThickness="6" Fill="Transparent"
                                                         StrokeDashArray="{Binding WeeklyProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                         StrokeDashOffset="{Binding WeeklyProgressOffset}"
                                                         StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                    <Ellipse.RenderTransform>
                                                        <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                    </Ellipse.RenderTransform>
                                                </Ellipse>
                                                <TextBlock Text="{Binding WeeklyProgress, StringFormat={}{0:0}}" FontSize="16" FontWeight="Bold" 
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{Binding OnSurface}"/>
                                            </Grid>
                                            <TextBlock Text="주간" FontSize="11" Foreground="{Binding OnSurfaceVariant}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                        <!-- Boss -->
                                        <StackPanel HorizontalAlignment="Center">
                                            <Grid Width="54" Height="54">
                                                <Ellipse Stroke="{Binding Outline}" StrokeThickness="6" Fill="Transparent"/>
                                                <Ellipse Stroke="#FF3B30" StrokeThickness="6" Fill="Transparent"
                                                         StrokeDashArray="{Binding BossProgress, Converter={StaticResource ProgressToDashArrayConverter}}" 
                                                         StrokeDashOffset="{Binding BossProgressOffset}"
                                                         StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                                    <Ellipse.RenderTransform>
                                                        <RotateTransform Angle="-90" CenterX="27" CenterY="27"/>
                                                    </Ellipse.RenderTransform>
                                                </Ellipse>
                                                <TextBlock Text="{Binding BossProgress, StringFormat={}{0:0}}" FontSize="16" FontWeight="Bold" 
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{Binding OnSurface}"/>
                                            </Grid>
                                            <TextBlock Text="보스" FontSize="11" Foreground="{Binding OnSurfaceVariant}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 일일 컨텐츠 섹션 -->
                            <!-- ═══════════════════════════════════════════ -->
                            <Border Background="{StaticResource MapleCyanGradient}" CornerRadius="8" Padding="16,12" Margin="0,0,0,10">
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="WeatherSunny24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                        <TextBlock Text="일일 컨텐츠" Foreground="White" FontWeight="Bold" FontSize="15"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding DailyProgress, StringFormat={}{0:0}%}" Foreground="White" FontWeight="Bold" FontSize="14" 
                                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <!-- 일반 모드: Daily -->
                            <ItemsControl ItemsSource="{Binding DailyView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource InverseBoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="TaskCard" 
                                                Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                RenderTransformOrigin="0.5,0.5">
                                            <Border.RenderTransform>
                                                <TransformGroup>
                                                    <ScaleTransform/>
                                                    <TranslateTransform/>
                                                </TransformGroup>
                                            </Border.RenderTransform>
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="#5AC8FA"/>
                                                            <Setter Property="BorderThickness" Value="1.5"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[1].(TranslateTransform.Y)"
                                                                                         From="0" To="30" Duration="0:0:0.3" BeginTime="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseIn"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                         From="1.0" To="0.0" Duration="0:0:0.3" BeginTime="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                        BorderBrush="#5AC8FA" BorderThickness="2" Background="Transparent"
                                                        VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="#5AC8FA"
                                                                   Visibility="{Binding IsChecked, Converter={StaticResource BoolToVis}}"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                           Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           FontSize="15" FontWeight="Medium" VerticalAlignment="Center"/>
                                                <Border Grid.Column="2" Background="#335AC8FA" CornerRadius="4" Padding="10,5" VerticalAlignment="Center">
                                                    <TextBlock Text="일일" Foreground="#5AC8FA" FontSize="11" FontWeight="Bold"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 편집 모드: Daily -->
                            <ItemsControl ItemsSource="{Binding DailyView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Name}" Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           VerticalAlignment="Center" FontWeight="Medium" FontSize="15"/>
                                                <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding IsActive}" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 주간 컨텐츠 섹션 -->
                            <!-- ═══════════════════════════════════════════ -->
                            <Border Background="#FF9500" CornerRadius="8" Padding="16,12" Margin="0,0,0,10">
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="Star24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                        <TextBlock Text="주간 컨텐츠" Foreground="White" FontWeight="Bold" FontSize="15"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding WeeklyProgress, StringFormat={}{0:0}%}" Foreground="White" FontWeight="Bold" FontSize="14" 
                                               HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <!-- 일반 모드: Weekly -->
                            <ItemsControl ItemsSource="{Binding WeeklyView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource InverseBoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="TaskCard" 
                                                Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                RenderTransformOrigin="0.5,0.5">
                                            <Border.RenderTransform>
                                                <TransformGroup>
                                                    <ScaleTransform/>
                                                    <TranslateTransform/>
                                                </TransformGroup>
                                            </Border.RenderTransform>
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="#FF9500"/>
                                                            <Setter Property="BorderThickness" Value="1.5"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[1].(TranslateTransform.Y)"
                                                                                         From="0" To="30" Duration="0:0:0.3" BeginTime="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseIn"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                         From="1.0" To="0.0" Duration="0:0:0.3" BeginTime="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                        BorderBrush="#FF9500" BorderThickness="2" Background="Transparent"
                                                        VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="#FF9500"
                                                                   Visibility="{Binding IsChecked, Converter={StaticResource BoolToVis}}"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                           Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           FontSize="15" FontWeight="Medium" VerticalAlignment="Center"/>
                                                <Border Grid.Column="2" Background="#33FF9500" CornerRadius="4" Padding="10,5" VerticalAlignment="Center">
                                                    <TextBlock Text="주간" Foreground="#FF9500" FontSize="11" FontWeight="Bold"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 편집 모드: Weekly -->
                            <ItemsControl ItemsSource="{Binding WeeklyView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Name}" Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           VerticalAlignment="Center" FontWeight="Medium" FontSize="15"/>
                                                <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding IsActive}" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 보스 컨텐츠 섹션 -->
                            <!-- ═══════════════════════════════════════════ -->
                            <Border Background="#FF3B30" CornerRadius="8" Padding="16,12" Margin="0,0,0,10">
                                <Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="Trophy24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                        <TextBlock Text="주간 보스" Foreground="White" FontWeight="Bold" FontSize="15"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Border Background="#33FFFFFF" CornerRadius="4" Padding="10,5">
                                            <TextBlock Text="{Binding BossCountText}" Foreground="White" FontWeight="Bold" FontSize="13"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- 일반 모드: Boss -->
                            <ItemsControl ItemsSource="{Binding BossView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource InverseBoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="TaskCard" 
                                                Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                RenderTransformOrigin="0.5,0.5">
                                            <Border.RenderTransform>
                                                <TransformGroup>
                                                    <ScaleTransform/>
                                                    <TranslateTransform/>
                                                </TransformGroup>
                                            </Border.RenderTransform>
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="#FF3B30"/>
                                                            <Setter Property="BorderThickness" Value="1.5"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[1].(TranslateTransform.Y)"
                                                                                         From="0" To="30" Duration="0:0:0.3" BeginTime="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseIn"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                         From="1.0" To="0.0" Duration="0:0:0.3" BeginTime="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                        BorderBrush="#FF3B30" BorderThickness="2" Background="Transparent"
                                                        VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="#FF3B30"
                                                                   Visibility="{Binding IsChecked, Converter={StaticResource BoolToVis}}"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <Border Grid.Column="1" Style="{StaticResource DifficultyBadgeStyle}" Margin="0,0,14,0">
                                                    <TextBlock Text="{Binding Difficulty}" Style="{StaticResource DifficultyTextStyle}"/>
                                                </Border>
                                                <TextBlock Grid.Column="2" Text="{Binding Name}" 
                                                           Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           FontSize="15" FontWeight="Medium" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                <Border Grid.Column="3" Background="#33FF3B30" CornerRadius="4" Padding="10,5" VerticalAlignment="Center">
                                                    <TextBlock Text="보스" Foreground="#FF3B30" FontSize="11" FontWeight="Bold"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 편집 모드: Boss (보스별 선택 가능 난이도만 표시) -->
                            <ItemsControl ItemsSource="{Binding BossView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Name}" Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           VerticalAlignment="Center" FontWeight="Medium" TextTrimming="CharacterEllipsis" FontSize="15"/>
                                                <!-- 보스별 선택 가능 난이도만 표시 -->
                                                <ComboBox Grid.Column="1" Width="95" Margin="8,0" 
                                                          ItemsSource="{Binding AvailableDifficulties}"
                                                          SelectedItem="{Binding Difficulty}"/>
                                                <ui:ToggleSwitch Grid.Column="2" IsChecked="{Binding IsActive}" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 월간 컨텐츠 섹션 -->
                            <!-- ═══════════════════════════════════════════ -->
                            <Border Background="#AF52DE" CornerRadius="8" Padding="16,12" Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="CalendarMonth24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                    <TextBlock Text="월간 컨텐츠" Foreground="White" FontWeight="Bold" FontSize="15"/>
                                </StackPanel>
                            </Border>

                            <!-- 일반 모드: Monthly -->
                            <ItemsControl ItemsSource="{Binding MonthlyView}" Margin="0,0,0,16"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource InverseBoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="TaskCard" 
                                                Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                RenderTransformOrigin="0.5,0.5">
                                            <Border.RenderTransform>
                                                <TransformGroup>
                                                    <ScaleTransform/>
                                                    <TranslateTransform/>
                                                </TransformGroup>
                                            </Border.RenderTransform>
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="BorderBrush" Value="#AF52DE"/>
                                                            <Setter Property="BorderThickness" Value="1.5"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                         From="1.0" To="1.08" Duration="0:0:0.1" AutoReverse="True"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[1].(TranslateTransform.Y)"
                                                                                         From="0" To="30" Duration="0:0:0.3" BeginTime="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseIn"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                         From="1.0" To="0.0" Duration="0:0:0.3" BeginTime="0:0:0.2"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                        BorderBrush="#AF52DE" BorderThickness="2" Background="Transparent"
                                                        VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="#AF52DE"
                                                                   Visibility="{Binding IsChecked, Converter={StaticResource BoolToVis}}"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                           Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           FontSize="15" FontWeight="Medium" VerticalAlignment="Center"/>
                                                <Border Grid.Column="2" Background="#33AF52DE" CornerRadius="4" Padding="10,5" VerticalAlignment="Center">
                                                    <TextBlock Text="월간" Foreground="#AF52DE" FontSize="11" FontWeight="Bold"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- 편집 모드: Monthly -->
                            <ItemsControl ItemsSource="{Binding MonthlyView}"
                                          Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DataContext.SurfaceContainer, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Name}" Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                           VerticalAlignment="Center" FontWeight="Medium" FontSize="15"/>
                                                <ui:ToggleSwitch Grid.Column="1" IsChecked="{Binding IsActive}" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- ═══════════════════════════════════════════ -->
                            <!-- 완료된 항목 섹션 (편집 모드가 아닐 때 + 완료 항목 있을 때만 표시) -->
                            <!-- ═══════════════════════════════════════════ -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding IsEditMode}" Value="False"/>
                                                    <Condition Binding="{Binding HasCompletedItems}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <!-- 섹션 헤더 -->
                                <Border CornerRadius="8" Padding="16,12" Margin="0,16,0,10">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#4CD964" Offset="0"/>
                                            <GradientStop Color="#34C759" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Grid>
                                        <StackPanel Orientation="Horizontal">
                                            <ui:SymbolIcon Symbol="CheckmarkCircle24" FontSize="18" Foreground="White" Margin="0,0,10,0"/>
                                            <TextBlock Text="완료된 항목" Foreground="White" FontWeight="Bold" FontSize="15"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding CompletedList.Count, StringFormat='{}{0}개 완료'}" 
                                                   Foreground="White" FontWeight="Bold" FontSize="14" Opacity="0.9"
                                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>

                                <!-- 완료된 항목 리스트 -->
                                <ItemsControl ItemsSource="{Binding CompletedList}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border x:Name="CompletedCard"
                                                    Background="{Binding DataContext.CompletedSurface, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    BorderBrush="{Binding DataContext.Outline, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,8" Cursor="Hand"
                                                    RenderTransformOrigin="0.5,0.5">
                                                <Border.RenderTransform>
                                                    <TransformGroup>
                                                        <ScaleTransform/>
                                                        <TranslateTransform/>
                                                    </TransformGroup>
                                                </Border.RenderTransform>
                                                <Border.InputBindings>
                                                    <MouseBinding MouseAction="LeftClick" 
                                                                  Command="{Binding DataContext.ToggleTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  CommandParameter="{Binding}"/>
                                                </Border.InputBindings>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="BorderBrush" Value="#4CD964"/>
                                                                <Setter Property="BorderThickness" Value="1.5"/>
                                                            </Trigger>
                                                            <!-- 복구 애니메이션 (체크 해제 시) -->
                                                            <DataTrigger Binding="{Binding IsChecked}" Value="False">
                                                                <DataTrigger.EnterActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"
                                                                                             From="0.95" To="1.0" Duration="0:0:0.2"/>
                                                                            <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"
                                                                                             From="0.95" To="1.0" Duration="0:0:0.2"/>
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                             From="0.5" To="1.0" Duration="0:0:0.2"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </DataTrigger.EnterActions>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- 완료 체크 아이콘 -->
                                                    <Border Width="24" Height="24" CornerRadius="12" Margin="0,0,14,0"
                                                            Background="#4CD964" VerticalAlignment="Center">
                                                        <ui:SymbolIcon Symbol="Checkmark16" FontSize="13" Foreground="White"
                                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>

                                                    <!-- 완료된 항목 이름 (취소선) -->
                                                    <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                               Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                               FontSize="15" FontWeight="Medium" VerticalAlignment="Center"
                                                               TextDecorations="Strikethrough" Opacity="0.7"/>

                                                    <!-- 카테고리 뱃지 -->
                                                    <Border Grid.Column="2" CornerRadius="4" Padding="10,5" Margin="10,0,0,0"
                                                            Background="{Binding Category, Converter={StaticResource CategoryToColorConverter}}"
                                                            Opacity="0.8" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Category, Converter={StaticResource CategoryToStringConverter}}" 
                                                                   Foreground="White" FontSize="11" FontWeight="Bold"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>

                                                    <!-- 되돌리기 힌트 아이콘 -->
                                                    <ui:SymbolIcon Grid.Column="3" Symbol="ArrowUndo16" 
                                                                   FontSize="16" Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                   Margin="12,0,0,0" Opacity="0.5" ToolTip="클릭하여 복구"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- 하단 푸터 -->
                    <Border VerticalAlignment="Bottom" Background="#3D4A5C" Padding="0,10">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,12,0">
                            <Button Command="{Binding OpenDashboardCommand}" Width="36" Height="36" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="전체 현황"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="DataBarVertical24" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                            <Button Command="{Binding ToggleEditModeCommand}" Width="36" Height="36" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="편집 모드"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="Edit24" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                            <Button Command="{Binding ToggleThemeCommand}" Width="36" Height="36" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="테마 전환"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="{Binding ThemeIcon}" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                            <Button Click="SettingsButton_Click" Width="36" Height="36" Padding="0" 
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="API 설정"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="Settings24" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                            <Border Width="1" Height="20" Background="#5A6A7E" Margin="4,0"/>
                            <Button Click="MinimizeButton_Click" Width="36" Height="36" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="최소화"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="Subtract24" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                            <Button Click="CloseButton_Click" Width="36" Height="36" Padding="0"
                                    Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="닫기 (트레이로 이동)"
                                    HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                                <ui:SymbolIcon Symbol="Dismiss24" FontSize="18" Foreground="#B0BEC5" Margin="0"/>
                            </Button>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- 캐릭터 선택 팝업 오버레이 -->
            <Border Grid.RowSpan="2" Background="#80000000" 
                    Visibility="{Binding IsCharacterSelectorOpen, Converter={StaticResource BoolToVis}}">
                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding ToggleCharacterSelectorCommand}"/>
                </Border.InputBindings>
                
                <Border Background="{Binding SurfaceContainer}" CornerRadius="16" 
                        HorizontalAlignment="Center" VerticalAlignment="Center"
                        MaxWidth="420" MinWidth="320" MaxHeight="500"
                        Margin="20" Padding="20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="4" Opacity="0.4"/>
                    </Border.Effect>
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick" Command="{x:Null}"/>
                    </Border.InputBindings>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 헤더 -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,16">
                            <TextBlock Text="캐릭터 선택" Foreground="{Binding OnSurface}" 
                                       FontSize="18" FontWeight="Bold"/>
                            <TextBlock Text="{Binding Characters.Count, StringFormat='{}{0}/10 캐릭터'}" 
                                       Foreground="{Binding OnSurfaceVariant}" FontSize="12" Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- 캐릭터 리스트 -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="300">
                            <ItemsControl ItemsSource="{Binding Characters}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding DataContext.Surface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                CornerRadius="10" Margin="0,0,0,8" Padding="12" Cursor="Hand"
                                                BorderThickness="2">
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick" 
                                                              Command="{Binding DataContext.SelectCharacterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="BorderBrush" Value="Transparent"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Value="True">
                                                            <DataTrigger.Binding>
                                                                <MultiBinding>
                                                                    <MultiBinding.Converter>
                                                                        <converters:EqualityConverter/>
                                                                    </MultiBinding.Converter>
                                                                    <Binding Path="."/>
                                                                    <Binding Path="DataContext.SelectedCharacter" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                                </MultiBinding>
                                                            </DataTrigger.Binding>
                                                            <Setter Property="BorderBrush" Value="#5AC8FA"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="50"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- 캐릭터 이미지 -->
                                                <Border Width="50" Height="50" CornerRadius="25" Background="Transparent" ClipToBounds="True">
                                                    <Border>
                                                        <Border.Background>
                                                            <ImageBrush ImageSource="{Binding ImageUrl}" Stretch="UniformToFill">
                                                                <ImageBrush.RelativeTransform>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.5" ScaleY="2.5"/>
                                                                </ImageBrush.RelativeTransform>
                                                            </ImageBrush>
                                                        </Border.Background>
                                                    </Border>
                                                </Border>

                                                <!-- 캐릭터 정보 -->
                                                <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Nickname}" 
                                                               Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                               FontSize="14" FontWeight="Bold"/>
                                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                        <TextBlock Text="Lv." Foreground="#5AC8FA" FontSize="11" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Level}" 
                                                                   Foreground="{Binding DataContext.OnSurface, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                   FontSize="12" FontWeight="Bold" Margin="2,0,6,0"/>
                                                        <TextBlock Text="{Binding CharacterClass}" 
                                                                   Foreground="{Binding DataContext.OnSurfaceVariant, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                   FontSize="11"/>
                                                    </StackPanel>
                                                </StackPanel>

                                                <!-- 선택 표시 / 삭제 버튼 -->
                                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <ui:SymbolIcon Symbol="Checkmark16" FontSize="16" Foreground="#5AC8FA" Margin="0,0,8,0">
                                                        <ui:SymbolIcon.Style>
                                                            <Style TargetType="ui:SymbolIcon">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Value="True">
                                                                        <DataTrigger.Binding>
                                                                            <MultiBinding>
                                                                                <MultiBinding.Converter>
                                                                                    <converters:EqualityConverter/>
                                                                                </MultiBinding.Converter>
                                                                                <Binding Path="."/>
                                                                                <Binding Path="DataContext.SelectedCharacter" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                                            </MultiBinding>
                                                                        </DataTrigger.Binding>
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </ui:SymbolIcon.Style>
                                                    </ui:SymbolIcon>
                                                    <Button Command="{Binding DataContext.RemoveCharacterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            Width="28" Height="28" Padding="0"
                                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                                            ToolTip="캐릭터 삭제" Opacity="0.6">
                                                        <ui:SymbolIcon Symbol="Delete16" FontSize="14" Foreground="#FF6B6B"/>
                                                    </Button>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- 추가 버튼 -->
                        <Button Grid.Row="2" Command="{Binding AddCharacterCommand}" 
                                HorizontalAlignment="Stretch" Margin="0,12,0,0"
                                Background="#5AC8FA" Foreground="White" 
                                Padding="12,10" Cursor="Hand"
                                IsEnabled="{Binding CanAddCharacter}">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        CornerRadius="8" Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Opacity" Value="0.5"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Add16" FontSize="16" Foreground="White" Margin="0,0,8,0"/>
                                <TextBlock Text="새 캐릭터 추가" FontSize="14" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>
            </Border>
        </Grid>
    </Border>
</Window>
