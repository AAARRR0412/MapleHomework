<ui:FluentWindow x:Class="MapleHomework.DashboardWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:MapleHomework"
        xmlns:converters="clr-namespace:MapleHomework.Converters"
        Title="ì „ì²´ ìºë¦­í„° í˜„í™©" 
        Height="800" Width="1300"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinWidth="1000" MinHeight="600"
        Background="#3D4A5C"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        UseLayoutRounding="True">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:ProgressToWidthConverter x:Key="ProgressToWidthConverter"/>
        <converters:TasksToTooltipConverter x:Key="TasksToTooltipConverter"/>
        
        <!-- ì§„í–‰ë¥  ë°” ìƒ‰ìƒ -->
        <LinearGradientBrush x:Key="DailyGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#5AC8FA" Offset="0"/>
            <GradientStop Color="#4ECDC4" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="WeeklyGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#FF9500" Offset="0"/>
            <GradientStop Color="#FFCC00" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="BossGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#FF3B30" Offset="0"/>
            <GradientStop Color="#FF2D55" Offset="1"/>
        </LinearGradientBrush>
        
        <Style x:Key="ProgressGridStyle" TargetType="Grid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Cursor" Value="Help"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="100"/>
            <Setter Property="ToolTipService.ShowDuration" Value="20000"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- íƒ€ì´í‹€ ë°” -->
        <Border Grid.Row="0" Background="#3D4A5C" Padding="24,16" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="DataBarVertical24" FontSize="26" Foreground="#5AC8FA" Margin="0,0,12,0"/>
                    <TextBlock Text="ì „ì²´ ìºë¦­í„° í˜„í™©" Foreground="White" FontSize="22" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <TextBlock Text="{Binding CharacterCount, StringFormat='ì´ {0}ê°œ ìºë¦­í„°'}" 
                               Foreground="#AABBCC" FontSize="14" Margin="0,0,20,0"
                               VerticalAlignment="Center"/>
                    
                    <Button Click="MinimizeButton_Click" Width="40" Height="40" Padding="0"
                            Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="ìµœì†Œí™”"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                        <ui:SymbolIcon Symbol="Subtract24" FontSize="20" Foreground="#B0BEC5" Margin="0"/>
                    </Button>
                    <Button Click="CloseButton_Click" Width="40" Height="40" Padding="0"
                            Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="ë‹«ê¸°"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                        <ui:SymbolIcon Symbol="Dismiss24" FontSize="20" Foreground="#B0BEC5" Margin="0"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ë©”ì¸ ì»¨í…ì¸ : ì™¼ìª½ ì˜¤ëŠ˜ì˜ í•  ì¼ + ì˜¤ë¥¸ìª½ ìºë¦­í„° ì¹´ë“œ -->
        <Grid Grid.Row="1" Margin="16,8,16,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="500"/>
                <ColumnDefinition Width="340"/>
            </Grid.ColumnDefinitions>

            <!-- ì™¼ìª½: ì˜¤ëŠ˜ì˜ í•  ì¼ (ì„¸ë¡œ ìŠ¤í¬ë¡¤) -->
            <Border Grid.Column="0" Background="#4A5A6E" CornerRadius="12" Margin="0,0,12,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- í—¤ë” -->
                    <Border Grid.Row="0" Background="#3D4A5C" CornerRadius="12,12,0,0" Padding="20,16">
                        <Grid>
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="Star24" FontSize="24" Foreground="#FFD700" Margin="0,0,12,0"/>
                                <TextBlock Text="ì˜¤ëŠ˜ì˜ í•  ì¼" Foreground="White" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
                                <Border Background="#FF3B30" CornerRadius="10" Padding="10,4" Margin="12,0,0,0" VerticalAlignment="Center"
                                        Visibility="{Binding HasPendingTasks, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="{Binding TotalPendingCount}" Foreground="White" FontSize="13" FontWeight="Bold"/>
                                </Border>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <TextBlock Text="ì¦ê²¨ì°¾ê¸°ë§Œ" Foreground="#AABBCC" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <ui:ToggleSwitch IsChecked="{Binding ShowOnlyFavorites, Mode=TwoWay}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- í•  ì¼ ëª©ë¡ (ì„¸ë¡œ ìŠ¤í¬ë¡¤, ìºë¦­í„°ë³„ ê·¸ë£¹) -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden" Padding="16">
                        <StackPanel>
                            <!-- í•  ì¼ì´ ìžˆì„ ë•Œ -->
                            <ItemsControl ItemsSource="{Binding GroupedTasks}" Visibility="{Binding HasPendingTasks, Converter={StaticResource BoolToVis}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#5A6A7E" CornerRadius="12" Padding="20" Margin="0,0,0,16">
                                            <StackPanel>
                                                <!-- ìºë¦­í„° í—¤ë” -->
                                                <Grid Margin="0,0,0,16">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                            <Border x:Name="CharacterAvatar" Width="56" Height="56" CornerRadius="28" ClipToBounds="True">
                                                        <Border.Background>
                                                            <ImageBrush Stretch="UniformToFill"
                                                                ImageSource="{Binding ImageUrl, FallbackValue={x:Null}, TargetNullValue={x:Null}}">
                                                                <ImageBrush.RelativeTransform>
                                                                    <ScaleTransform CenterX="0.5" CenterY="0.55" ScaleX="3.5" ScaleY="3.5"/>
                                                                </ImageBrush.RelativeTransform>
                                                            </ImageBrush>
                                                        </Border.Background>
                                                    </Border>
                                                    
                                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="16,0,0,0">
                                                        <TextBlock Text="{Binding Nickname}" Foreground="White" FontSize="18" FontWeight="Bold"/>
                                                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                            <TextBlock Text="Lv." Foreground="#5AC8FA" FontSize="14"/>
                                                            <TextBlock Text="{Binding Level}" Foreground="#AABBCC" FontSize="14" FontWeight="SemiBold" Margin="2,0,0,0"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    
                                                    <Border Grid.Column="2" Background="#FF3B30" CornerRadius="12" Padding="14,6" VerticalAlignment="Center">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding PendingCount}" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                                            <TextBlock Text="ê°œ ë‚¨ìŒ" Foreground="#FFCCCC" FontSize="12" VerticalAlignment="Bottom" Margin="4,0,0,1"/>
                                                        </StackPanel>
                                                    </Border>
                                                </Grid>

                                                <!-- êµ¬ë¶„ì„  -->
                                                <Border Height="1" Background="#44FFFFFF" Margin="0,0,0,14"/>

                                                <!-- ìˆ™ì œ ëª©ë¡ (ë°˜ì‘í˜• ê·¸ë¦¬ë“œ) -->
                                                <ItemsControl ItemsSource="{Binding Tasks}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <UniformGrid Columns="{Binding DataContext.TaskColumnCount, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border CornerRadius="8" Padding="12,10" Margin="0,0,8,8"
                                                                    Background="{Binding CategoryColor}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <Border Background="#33FFFFFF" CornerRadius="4" Padding="6,3" VerticalAlignment="Center">
                                                                        <TextBlock Text="{Binding CategoryText}" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                                                    </Border>
                                                                    <TextBlock Text="{Binding TaskName}" Foreground="White" FontSize="13" FontWeight="Medium" 
                                                                               VerticalAlignment="Center" Margin="8,0,0,0" TextTrimming="CharacterEllipsis"/>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- í•  ì¼ì´ ì—†ì„ ë•Œ -->
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,60,0,0">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasPendingTasks}" Value="False">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="{Binding EmptyMessage}" Foreground="#88FFFFFF" FontSize="18" 
                                           HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center"/>
                                <TextBlock Text="{Binding EmptySubMessage}" Foreground="#55FFFFFF" FontSize="13" 
                                           HorizontalAlignment="Center" Margin="0,8,0,0" TextWrapping="Wrap" TextAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- ì˜¤ë¥¸ìª½: ìºë¦­í„° ì¹´ë“œ ì‚¬ì´ë“œë°” -->
            <Border Grid.Column="1" Background="#4A5A6E" CornerRadius="12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- ì‚¬ì´ë“œë°” í—¤ë” -->
                    <Border Grid.Row="0" Background="#3D4A5C" CornerRadius="12,12,0,0" Padding="16,14">
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="People24" FontSize="20" Foreground="#5AC8FA" Margin="0,0,10,0"/>
                            <TextBlock Text="ìºë¦­í„° ëª©ë¡" Foreground="White" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- ìºë¦­í„° ë¦¬ìŠ¤íŠ¸ -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden" Padding="12">
                        <ItemsControl ItemsSource="{Binding Characters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#5A6A7E" CornerRadius="12" Padding="14" Margin="0,0,0,12" Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftClick" 
                                                          Command="{Binding DataContext.SelectAndCloseCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                          CommandParameter="{Binding}"/>
                                        </Border.InputBindings>
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#6A7A8E"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- ìºë¦­í„° ì´ë¯¸ì§€ (60% ì¦ê°€: 50â†’80) -->
                                            <Border x:Name="CharacterListAvatar" Width="80" Height="80" CornerRadius="40" ClipToBounds="True" VerticalAlignment="Center">
                                                <Border.Background>
                                                    <ImageBrush Stretch="UniformToFill"
                                                                ImageSource="{Binding ImageUrl, TargetNullValue={x:Null}, FallbackValue={x:Null}}">
                                                        <ImageBrush.RelativeTransform>
                                                            <ScaleTransform CenterX="0.5" CenterY="0.55" ScaleX="3.5" ScaleY="3.5"/>
                                                        </ImageBrush.RelativeTransform>
                                                    </ImageBrush>
                                                </Border.Background>
                                            </Border>

                                            <!-- ìºë¦­í„° ì •ë³´ -->
                                            <StackPanel Grid.Column="1" Margin="14,0,0,0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Nickname}" Foreground="White" FontSize="15" FontWeight="Bold"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                    <TextBlock Text="Lv." Foreground="#5AC8FA" FontSize="12"/>
                                                    <TextBlock Text="{Binding Level}" Foreground="White" FontSize="13" FontWeight="SemiBold" Margin="2,0,8,0"/>
                                                    <TextBlock Text="{Binding CharacterClass}" Foreground="#AABBCC" FontSize="12" TextTrimming="CharacterEllipsis"/>
                                                </StackPanel>
                                                <!-- ì§„í–‰ë¥  ë°” -->
                                                <Grid Margin="0,10,0,0">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <!-- ì¼ì¼ ì§„í–‰ë¥  -->
                                                    <Grid Grid.Row="0" Margin="0,0,0,6">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="32"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="32"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="ì¼ì¼" Foreground="#5AC8FA" FontSize="11" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <Border Grid.Column="1" Height="6" CornerRadius="3" Background="#33FFFFFF">
                                                            <Border CornerRadius="3" Background="#5AC8FA" HorizontalAlignment="Left"
                                                                    Width="{Binding DailyProgress, Converter={StaticResource ProgressToWidthConverter}}"/>
                                                        </Border>
                                                        <TextBlock Grid.Column="2" Text="{Binding DailyProgress, StringFormat='{}{0:F0}%'}" Foreground="#5AC8FA" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                                    </Grid>
                                                    <!-- ì£¼ê°„ ì§„í–‰ë¥  -->
                                                    <Grid Grid.Row="1" Margin="0,0,0,6">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="32"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="32"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="ì£¼ê°„" Foreground="#FF9500" FontSize="11" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <Border Grid.Column="1" Height="6" CornerRadius="3" Background="#33FFFFFF">
                                                            <Border CornerRadius="3" Background="#FF9500" HorizontalAlignment="Left"
                                                                    Width="{Binding WeeklyProgress, Converter={StaticResource ProgressToWidthConverter}}"/>
                                                        </Border>
                                                        <TextBlock Grid.Column="2" Text="{Binding WeeklyProgress, StringFormat='{}{0:F0}%'}" Foreground="#FF9500" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                                    </Grid>
                                                    <!-- ë³´ìŠ¤ ì§„í–‰ë¥  -->
                                                    <Grid Grid.Row="2">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="32"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="32"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Text="ë³´ìŠ¤" Foreground="#FF3B30" FontSize="11" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <Border Grid.Column="1" Height="6" CornerRadius="3" Background="#33FFFFFF">
                                                            <Border CornerRadius="3" Background="#FF3B30" HorizontalAlignment="Left"
                                                                    Width="{Binding BossProgress, Converter={StaticResource ProgressToWidthConverter}}"/>
                                                        </Border>
                                                        <TextBlock Grid.Column="2" Text="{Binding BossProgress, StringFormat='{}{0:F0}%'}" Foreground="#FF3B30" FontSize="11" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Grid>
                                                <!-- ìˆ˜ìµ ì •ë³´ -->
                                                <Border Background="#33FFD700" CornerRadius="6" Padding="10,6" Margin="0,10,0,0">
                                                    <Grid>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="ðŸ’°" FontSize="12" Margin="0,0,6,0"/>
                                                            <TextBlock Text="{Binding WeeklyBossRewardText}" Foreground="#FFD700" FontSize="12" FontWeight="Bold"/>
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding WeeklyBossExpectedRewardText, StringFormat='/ {0}'}" 
                                                                   Foreground="#AABBCC" FontSize="11" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ui:FluentWindow>
